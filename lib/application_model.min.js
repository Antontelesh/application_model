(function(){var ApplicationModel,snake,valueFn,_;_=require("lodash"),snake=require("./snake"),valueFn=require("./valuefn"),ApplicationModel=function(){function ApplicationModel(params,defaults){var formatters,getters,getters_setters,parsers,setters;this.__attributes={},getters=this.__getters=this.getGetters(),setters=this.__setters=this.getSetters(),parsers=this.__parsers=this.getParsers(),formatters=this.__formatters=this.getFormatters(),getters_setters=_.difference(_.union(_.keys(getters),_.keys(setters)),_.keys(parsers)),_.each(parsers,function(functionName,prop_name){return Object.defineProperty(this,prop_name,{enumerable:!0,get:createGetter(prop_name,this.__attributes),set:createSetter(prop_name,this[functionName],this.__attributes)})},this),_.each(getters_setters,function(prop_name){return Object.defineProperty(this,prop_name,{enumerable:!0,get:this[getters[prop_name]],set:this[setters[prop_name]]})},this),_.assign(defaults,params),_.assign(this,defaults)}var createGetter,createSetter;return createGetter=function(prop_name,attributes){return function(){return attributes[prop_name]}},createSetter=function(prop_name,fn,attributes){return function(value){return attributes[prop_name]=fn(value)}},ApplicationModel.prototype.toPlainObject=function(){var _resolve;return _resolve=function(value){return value instanceof ApplicationModel?value.toPlainObject():_.isArray(value)?_.map(value,_resolve):value?JSON.parse(JSON.stringify(value)):value},_.reduce(this.getOwnKeys(),function(result,key){return result[key]=_resolve(this[key]),result},{},this)},ApplicationModel.prototype.format=function(){var _resolve;return _resolve=function(value){return value instanceof ApplicationModel?value.format():_.isArray(value)?_.map(value,_resolve):value?JSON.parse(JSON.stringify(value)):value},_.reduce(this.getOwnKeys(),function(result,key){var formatter;return formatter=this[this.__formatters[key]]||valueFn,result[key]=_resolve(formatter.call(this,this[key])),result},{},this)},ApplicationModel.prototype.getOwnKeys=function(){return _.reject(_.keys(this),function(key){return 0===key.indexOf("__")})},ApplicationModel.prototype.getMutators=function(type){var methods,mutators,pattern;return methods=_.methods(this),pattern=new RegExp(type+"(\\w+)Attribute"),mutators=_.filter(methods,function(method){return pattern.test(method)}),_.reduce(mutators,function(result,mutator_name){var prop_name;return prop_name=snake(mutator_name.match(pattern)[1]),result[prop_name]=mutator_name,result},{})},ApplicationModel.prototype.getGetters=function(){return this.getMutators("get")},ApplicationModel.prototype.getSetters=function(){return this.getMutators("set")},ApplicationModel.prototype.getParsers=function(){return this.getMutators("parse")},ApplicationModel.prototype.getFormatters=function(){return this.getMutators("format")},ApplicationModel}(),module.exports=ApplicationModel}).call(this);